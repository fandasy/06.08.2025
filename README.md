# Тестовое задание: REST API, ZIP Archiver service

Go 1.24.2+

REST API проект, выполняющая задачи архиватора

## Содержание

- [Кратко про REST-методы](#rest-методы)
- [Swagger](#swagger)
- [Конфиг](#конфиг)
- [Запуск](#запуск)
    - [Параметры запуска](#настройка-окружения-и-параметров-запуска)
    - [Быстрый старт](#быстрый-старт)

## REST-методы

- Создание новой задачи
- Получение статуса и информации по задаче
- Загрузка zip архива по его имени
- Добавление объекта/объектов в задачу (при достижении максимума запускается архивация)

JSON Формат для добавления объекта/объектов

```json
{
  "urls": [
    "https://www.gstatic.com/webp/gallery/1.jpg"
  ]
}
```

**Более подробно про REST-методы можно посмотреть в Swagger файлах**

## Swagger

Файлы Swagger находятся в каталоге [docs](docs)

```
  /docs
    docs.go
    swagger.json
    swagger.yaml
```

Swagger GUI path: [GET] localhost:8080/swagger/index.html

Если вы используете другой графический интерфейс Swagger, обязательно измените адрес и порт на свои значения

## Конфиг

Приложение настраивается через YAML-файл.

Ниже приведён пример конфига с описанием каждого поля:

```yaml
logger:
  dir: "" # Имя каталога, в котором будут храниться логи. Если поле пустое, логи выводятся в os.Stdout

archiver:
  max_tasks: 3 # Максимальное количество задач (task), которые могут существовать одновременно
  max_objects: 3 # Максимальное количество объектов в задаче, запускающих архивацию
  valid_extension: # Допустимые расширения файлов, которые проверяются перед добавлением в задачу. Если конфиг пустой, то проверка не производится
    - ".pdf"
    - ".jpg"
    - ".jpeg"
  archive_object_getter:
    valid_content_type: # Допустимые типы контента, которые проверяются на этапе «Архивация» во время загрузки файла. Если конфиг пустой, то проверка не производится
    # - "application/pdf"
    # - "image/jpeg"

local_zip_storage:
  dir: "zips" # Имя каталога, в котором будут храниться конечные zip-архивы

http_server:
  addr: "localhost:8080"
  idle_timeout: 30s
```

### Описание ключевых параметров

#### `logger.dir`

* **Тип:** `string`
* **Назначение:** Путь до каталога для сохранения логов.
  Если оставить пустым (`""`), логи будут выводиться в консоль (`os.Stdout`).

#### `archiver.max_tasks`

* **Тип:** `uint32`
* **Назначение:** Ограничивает количество задач архивации, которые могут выполняться одновременно.
  При попытке создать новую задачу, если лимит превышен — возвращается ошибка.

#### `archiver.max_objects`

* **Тип:** `int`
* **Назначение:** Количество файлов в задаче, при котором она автоматически переходит к стадии архивации.

#### `archiver.valid_extension`

* **Тип:** `[]string`
* **Назначение:** Ограничивает список допустимых расширений файлов при добавлении в задачу.
  Если список пуст — проверка расширений не выполняется.

#### `archiver.archive_object_getter.valid_content_type`

* **Тип:** `[]string`
* **Назначение:** Список допустимых MIME-типов файлов при загрузке во время архивации.
  Если список пуст — проверка не выполняется.

#### `local_zip_storage.dir`

* **Тип:** `string`
* **Назначение:** Путь до директории, где будут сохраняться готовые ZIP-архивы.

#### `http_server.addr`

* **Тип:** `string`
* **Назначение:** Адрес и порт, на котором будет запущен HTTP-сервер.

#### `http_server.idle_timeout`

* **Тип:** `duration`
* **Назначение:** Время простоя соединения до его закрытия.
  Задаётся в формате Go (`30s`, `1m`, и т.п.).

## Запуск

### Настройка окружения и параметров запуска

Приложение поддерживает настройку через **параметры запуска** (CLI-флаги) и **переменные окружения**.

#### 1. `Env` — режим окружения
Определяет, в каком окружении будет запущено приложение.  
Задаётся:
- переменной окружения: `ENV`
- или CLI-параметром: `--env`

Доступные значения:
- **`local`** — локальная среда разработки.  
  Логи в обычном текстовом формате, уровень — `Debug`.
- **`dev`** — среда разработки.  
  Логи в формате JSON, уровень — `Debug`.
- **`prod`** — рабочая среда (продакшн).  
  Логи в формате JSON, уровень — `Info`, включается `gin.ReleaseMode`.

> Если значение не указано, по умолчанию используется **`local`**.

---

#### 2. `Config` — путь к конфигурационному файлу
Определяет путь к YAML-файлу с настройками приложения.  
Задаётся:
- переменной окружения: `CONFIG_PATH`
- или CLI-параметром: `--config`

> Если значение не указано, по умолчанию используется **`./config/local.yaml`**.

### Быстрый старт

При использовании быстрого старта используются значения по умолчанию!

```bash
git clone https://github.com/fandasy/06.08.2025.git
cd 06.08.2025

go mod tidy

go run ./cmd/zipper/main.go
```

### Custom start

```bash
git clone https://github.com/fandasy/06.08.2025.git
cd 06.08.2025

go mod tidy

go run ./cmd/zipper/main.go --env prod --config ./config/your_config.yaml
```
